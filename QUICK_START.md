# ??????? ?????: ???????? ?????????????? ???????????

## 1. ????????? Seq (???? ??? ?? ???????)

```bash
docker run --name seq -d --restart unless-stopped -e ACCEPT_EULA=Y -p 5341:80 datalust/seq:latest
```

???????? Seq UI: http://localhost:5341

## 2. ????????? ???????

????????? ??? ??????? ????????????:

### Backend API
```bash
cd Observability_WebApi_Blazor.Backend
dotnet run
```
????? ??????? ??: https://localhost:7036

### Blazor Server
```bash
cd Observability_WebAPI_Blazor\Observability_WebAPI_Blazor
dotnet run
```
????? ??????? ??: https://localhost:XXXX

## 3. ????????? ??????

1. ???????? Blazor ?????????? ? ????????
2. ????????? ?? ???????? "Weather"
3. ???????? Seq UI: http://localhost:5341

## 4. ??? ?????? ? Seq

### ?????? ?? ??????????
```
Application = 'Blazor-Server' OR Application = 'Backend'
```

### ????? ?????????? ??????
1. ? ??????? Blazor Server ??????? TraceId (????????: `00-abc123def456-789-00`)
2. ? Seq ???????: `TraceId = '00-abc123def456-789-00'`
3. ?? ??????? ??? ??????? (?? Blazor ? Backend) ? ???? TraceId

## 5. ??? ?? ?????? ???????

### ? ??????? Blazor Server:
```
09:15:30 [INF] [00-abc123def456-789-00] HTTP GET /weather responded 200 in 245.6789 ms
09:15:30 [INF] [00-abc123def456-789-00] Calling backend API to get weather forecast
```

### ? ??????? Backend:
```
09:15:31 [INF] [00-abc123def456-789-00] HTTP GET /WeatherForecast responded 200 in 5.1234 ms
09:15:31 [INF] [00-abc123def456-789-00] Getting weather forecast. TraceId: 00-abc123def456-789-00
```

### ? Seq:
??? ??????? ? ?????????? TraceId ????? ???????, ??? ????????? ????????? ???? ???? ???????!

## ???????? Headers

?? ?????? ?????????, ??? ????????? ?????????? ?????????, ??????? ? Backend ??????????:

```csharp
[HttpGet(Name = "GetWeatherForecast")]
public IEnumerable<WeatherForecast> Get()
{
    var traceParent = Request.Headers["traceparent"].FirstOrDefault();
    _logger.LogInformation("Received traceparent header: {TraceParent}", traceParent);
    _logger.LogInformation("Getting weather forecast. TraceId: {TraceId}", HttpContext.TraceIdentifier);
    
    // ...
}
```

## Troubleshooting

### ????????: TraceId ??????
- ?????????, ??? Backend ???????? ????????? `traceparent`
- ????????? CORS ????????? ? Backend
- ?????????, ??? TraceContextHandler ??????????????? ? DI

### ????????: ??? ????? ? Seq
- ?????????, ??? Seq ???????: http://localhost:5341
- ????????? ???????????? `Seq:Url` ? appsettings.json
- ????????? ?????????? ????? - ???? ?????? ???? ? ???

### ????????: CORS ??????
- ?????????, ??? `app.UseCors()` ?????????? ? Backend
- ?????????, ??? BackendUrl ? ???????????? ??????????
